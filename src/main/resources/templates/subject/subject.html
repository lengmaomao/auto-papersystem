<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>添加试题</title>

    <script src="/layui/layui.js"></script>
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="/js/paper/paper.js"></script>

    <link rel="stylesheet" href="/layui/css/layui.css"/>
</head>
<body >
<!--    顶部菜单-->
<div class="top-menu layui-header header header-doc">
    <ul class="layui-nav" lay-filter="">
        <li class="layui-nav-item"><a href="">最新活动</a></li>
        <li class="layui-nav-item layui-this"><a href="">产品</a></li>
        <li class="layui-nav-item"><a href="">大数据</a></li>
        <li class="layui-nav-item">
            <a href="javascript:;">解决方案</a>
            <dl class="layui-nav-child"> <!-- 二级菜单 -->
                <dd><a href="">移动模块</a></dd>
                <dd><a href="">后台模版</a></dd>
                <dd><a href="">电商平台</a></dd>
            </dl>
        </li>
        <li class="layui-nav-item"><a href="">社区</a></li>
    </ul>
</div>
<!--    左边的菜单-->
<div class="left-menu" >
    <ul class="layui-nav layui-nav-tree layui-nav-side" lay-filter="test" style="padding-top: 60px">
        <!-- 侧边导航: <ul class="layui-nav layui-nav-tree layui-nav-side"> -->
        <li class="layui-nav-item">
            <a href="javascript:;">试卷管理</a>
            <dl class="layui-nav-child">
                <dd><a href="javascript:;">新建试卷</a></dd>
                <dd><a href="javascript:;">我的试卷</a></dd>
                <dd><a href="javascript:;">试卷库</a></dd>
            </dl>
        </li>
        <li class="layui-nav-item">
            <a href="javascript:;">题库</a>
            <dl class="layui-nav-child">
                <dd><a href="">我的试题</a></dd>
                <dd><a href="">新建试题</a></dd>
                <dd><a href="">公共题库</a></dd>
            </dl>
        </li>
        <li class="layui-nav-item"><a href="">没想好</a></li>
        <li class="layui-nav-item"><a href="">真没想好</a></li>
    </ul>
</div>
<!--页面主体部分-->
<div class="layui-row" style="padding-top: 60px">
    <div class="layui-col-md3">a</div>
    <div class="layui-col-md6 layui-tab" lay-filter="addSubject" >
            <ul class="layui-tab-title" disabled>
                <li class="layui-this" lay-id="base_tabHead">1.题目基本信息</li>
                <li lay-id="course_tabHead">2.题目所属科目</li>
                <li lay-id="knowledge_tabHead">3.题目知识点</li>
                <li lay-id="finish_tabHead">4.完成</li>
            </ul>
            <div class="layui-tab-content">
                <!--            题目基本信息-->
                <div class="layui-tab-item layui-show">
                    <fieldset class="layui-elem-field">
                        <legend>试卷添加----基本信息</legend>
                    <form class="layui-form layui-field-box" action="" id="base_tabBody" lay-filter="base_tabBody">
                        <div class="layui-form-item layui-show">
                            <label required class="layui-form-label">题目类型</label>
                            <div class="layui-input-block">
                                <select name="subjectType" lay-verify="required">
                                    <option value=""></option>
                                    <option value="单项选择题">单项选择题</option>
                                    <option value="多项选择题">多项选择题</option>
                                    <option value="填空题">填空题</option>
                                    <option value="判断题">判断题</option>
                                    <option value="简答题">简答题</option>
                                    <option value="综合题">综合题</option>
                                </select>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">分数</label>
                            <div class="layui-input-inline">
                                <input  name="grade" required lay-verify="required" placeholder="分数" autocomplete="off" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">难度选择</label>
                            <div class="layui-input-block">
                                <input type="radio" name="DIFFICULTY" value="1" title="困难">
                                <input type="radio" name="DIFFICULTY" value="2" title="普通" checked>
                                <input type="radio" name="DIFFICULTY" value="3" title="简单" >
                            </div>
                        </div>
                        <div class="layui-form-item layui-form-text">
                            <label class="layui-form-label">题目描述</label>
                            <div class="layui-input-block">
                                <textarea required name="desc" placeholder="请输入题目描述" class="layui-textarea"></textarea>
                            </div>
                        </div>
                        <div class="layui-form-item layui-form-text">
                            <label class="layui-form-label">答案</label>
                            <div class="layui-input-block">
                                <textarea required name="answer" placeholder="请输入内容(如果是选择题,请使用空格将选项隔开)" class="layui-textarea"></textarea>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <div class="layui-input-block">
                                <button class="layui-btn"  lay-submit lay-filter="to_2">下一步</button>
                            </div>
                        </div>
                    </form>
                    </fieldset>
                </div>

                <!--            题目所属科目-->
                <div class="layui-tab-item">
                    <fieldset class="layui-elem-field">
                        <legend>试卷添加----选择科目</legend>
                    <form class="layui-form layui-field-box" id="course_tabBody" lay-filter="course_tabBody">
                            <div class="layui-form-item layui-show">
                                <label required class="layui-form-label" >所属科目</label>
                                <div class="layui-input-block">
                                    <select class="course_select" name="course" lay-verify="required" lay-filter="course_select" lay-search >
                                        <option value="">输入科目</option>
                                    </select>
                                </div>
                            </div>
                        <div class="layui-form-item">
                            <div class="layui-input-block">
                                <button class="layui-btn  layui-btn-primary"  lay-submit lay-filter="to_1">上一步</button>
                                <button class="layui-btn"  lay-submit lay-filter="to_3">下一步</button>
                            </div>
                        </div>
                    </form>
                    </fieldset>
                </div>
                <!--            题目所属知识点-->
                <div class="layui-tab-item">
                    <fieldset class="layui-elem-field">
                        <legend>试卷添加----选择知识点</legend>
                        <form class="layui-form layui-field-box" id="knowledge_tabBody" lay-filter="knowledge_tabBody">
                                <div class="layui-form-item layui-show">
                                    <label required class="layui-form-label">知识点</label>
                                    <div class="layui-input-block">
                                        <select class="knowledge_select" lay-filter="knowledge_select" name="course" lay-verify="required" lay-search>
                                        </select>
                                    </div>
                                </div>
                            <div class="layui-form-item">
                                <div class="layui-input-block">
                                    <button class="layui-btn  layui-btn-primary"  lay-submit lay-filter="to_2">上一步</button>
                                    <button class="layui-btn"  lay-submit lay-filter="to_4">下一步</button>
                                </div>
                            </div>
                        </form>
                    </fieldset>
                </div>
                <!--            完成面板-->
                <div class="layui-tab-item" lay-filter="finish-tab">
                    <fieldset class="layui-elem-field">
                        <legend>试卷添加----信息总览</legend>
                        <form class="layui-form layui-field-box" id="finish_tabBody" lay-filter="finish_tabBody">
                            <div class="layui-form-item layui-show">
                                <label required class="layui-form-label">题目类型</label>
                                <div class="layui-input-block">
                                    <select name="subjectType" lay-verify="required" disabled>
                                        <option value=""></option>
                                        <option value="单项选择题">单项选择题</option>
                                        <option value="多项选择题">多项选择题</option>
                                        <option value="填空题">填空题</option>
                                        <option value="判断题">判断题</option>
                                        <option value="简答题">简答题</option>
                                        <option value="综合题">综合题</option>
                                    </select>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">分数</label>
                                <div class="layui-input-inline">
                                    <input  name="grade" required lay-verify="required" placeholder="分数" autocomplete="off" class="layui-input" disabled>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label" >是否公开</label>
                                <div class="layui-input-block">
                                    <input type="checkbox" name="share" lay-skin="switch" lay-text="公开|私有" value="true" >
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">难度选择</label>
                                <div class="layui-input-block" >
                                    <input type="radio" name="DIFFICULTY" value="1" title="困难" disabled>
                                    <input type="radio" name="DIFFICULTY" value="2" title="普通" disabled>
                                    <input type="radio" name="DIFFICULTY" value="3" title="简单" disabled>
                                </div>
                            </div>
                            <div class="layui-form-item layui-show">
                                <label required class="layui-form-label">所属科目</label>
                                <div class="layui-input-block">
                                    <select class="course_select"  lay-filter="course_select" name="course" lay-verify="required" disabled>
                                    </select>
                                </div>
                            </div>
                            <div class="layui-form-item layui-show">
                                <label required class="layui-form-label">知识点</label>
                                <div class="layui-input-block">
                                    <select class="knowledge_select" lay-filter="knowledge_select" name="knowledge" lay-verify="required" disabled>
                                    </select>
                                </div>
                            </div>
                            <div class="layui-form-item layui-form-text">
                                <label class="layui-form-label">题目描述</label>
                                <div class="layui-input-block">
                                    <textarea required name="desc" placeholder="请输入题目描述" class="layui-textarea" disabled></textarea>
                                </div>
                            </div>
                            <div class="layui-form-item layui-form-text">
                                <label class="layui-form-label">答案</label>
                                <div class="layui-input-block">
                                    <textarea required name="answer" placeholder="请输入内容(如果是选择题,请使用空格将选项隔开)" class="layui-textarea" disabled></textarea>
                                </div>
                            </div>

                            <div class="layui-form-item">
                                <div class="layui-input-block">
                                    <button class="layui-btn  layui-btn-primary"  lay-submit lay-filter="to_3">上一步</button>
                                    <button class="layui-btn" lay-filter="subject_submit"  lay-submit>完成</button>
                                </div>
                            </div>
                        </form>
                        </form>
                    </fieldset>
                </div>
            </div>
    </div>

    <script>
        //刷新科目信息
        $.ajax({
            type: "POST",
            url: "/course/all_course",
            success: function (data) {
                for (let course in data){
                    $(".course_select").append("<option value="+data[course].courseId+">"+data[course].courseName+" "+data[course].courseBook+"</option>")
                }
            }
        })
        layui.use('form', function(){
            const form = layui.form;
            // 标签页
            const element = layui.element;
            element.on('tab(addSubject)', function(data){
                console.log(data);
                if (data.index == 3){
                    const data1 = form.val("base_tabBody");
                    const data2 = form.val("course_tabBody");
                    const data3 = form.val("knowledge_tabBody");
                    console.log(data1);
                    console.log(data2);
                    console.log(data3);
                    form.val("finish_tabBody",data1);
                    form.val("finish_tabBody",data2);
                    form.val("finish_tabBody",data3);
                }
            });
            //监听提交
            form.on('submit(subject_submit)', function(form_data){
                console.log(form_data);
                let field = form_data.field;
                console.log(field);
                let share;
                if (field.share == "true")
                     share = true;
                else
                     share = false;
                let data = {
                    "subjectCourse":{
                        "courseId":field.course,
                    },
                    "subjectKnowledge":{
                        "knowledgeId":field.knowledge,
                    },
                    "subjectScore":field.subjectScore,
                    "subjectType":field.subjectType,
                    "subjectDescribe":field.desc,
                    "subjectAnswer":field.answer,
                    "subjectDifficulty":field.DIFFICULTY,
                    "subjectShare": share
                }
                $.ajax({
                    type: "POST",
                    url:"/subject/add_subject",
                    contentType: "application/json",
                    data:(JSON.stringify(data)),
                })
                console.log(JSON.stringify(data))
                layer.msg(JSON.stringify(data));
                return false;
            });

            //监听科目选择后进行知识点更新查询
            form.on('select(course_select)',function (field_data) {
                let courseId = field_data.value;
                alert(courseId);
                let data={
                    "knowledgeCourse":{
                        "courseId": courseId
                    }
                }
                $.ajax({
                    type: "POST",
                    url: "/knowledge/find_knowledge",
                    contentType: "application/json",
                    data: JSON.stringify(data),
                    success:function (data) {
                        $(".knowledge_select").empty();
                        for (let knowledge in data){
                            $(".knowledge_select").append("<option value="+data[knowledge].knowledgeId+">"+data[knowledge].knowledgeContext+"</option>");
                        }
                        form.render('select');
                    }
                })
            })
            //监听to_num
            form.on('submit(to_1)',function () {
                element.tabChange('addSubject', 'base_tabHead');
                return false;
            })
            form.on('submit(to_2)',function () {

                element.tabChange('addSubject', 'course_tabHead');
                return false;
            })
            form.on('submit(to_3)',function () {
                element.tabChange('addSubject', 'knowledge_tabHead');
                return false;
            })
            form.on('submit(to_4)',function () {
                element.tabChange('addSubject', 'finish_tabHead');
                const data1 = form.val("base_tabBody");
                const data2 = form.val("course_tabBody");
                const data3 = form.val("knowledge_tabBody");
                console.log(data1);
                console.log(data2);
                console.log(data3);
                form.val("finish_tabBody",data1);
                form.val("finish_tabBody",data2);
                form.val("finish_tabBody",data3);
                return false;
            })
            //监听下拉框

        });

    </script>
</div>


</body>
</html>